<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="apppasteleriav04.Views.Profile.Manager.ManagerPage"
             Title="Dashboard Gerente">
    
    <RefreshView IsRefreshing="{Binding IsBusy}" 
                 Command="{Binding RefreshCommand}">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="16">
                
                <!-- Header -->
                <Label Text="Dashboard Gerente" 
                       FontSize="24" 
                       FontAttributes="Bold"/>
                
                <!-- KPI Cards Row -->
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                    
                    <!-- Today Sales -->
                    <Frame Grid.Column="0" 
                           BackgroundColor="#E8F5E9" 
                           CornerRadius="10" 
                           Padding="12">
                        <VerticalStackLayout>
                            <Label Text="Ventas Hoy" FontSize="12" TextColor="#666"/>
                            <Label x:Name="TodaySalesLabel" 
                                   Text="{Binding TodaySales, StringFormat='S/. {0:F2}'}" 
                                   FontSize="20" 
                                   FontAttributes="Bold" 
                                   TextColor="#2E7D32"/>
                        </VerticalStackLayout>
                    </Frame>
                    
                    <!-- Today Orders -->
                    <Frame Grid.Column="1" 
                           BackgroundColor="#E3F2FD" 
                           CornerRadius="10" 
                           Padding="12">
                        <VerticalStackLayout>
                            <Label Text="Pedidos Hoy" FontSize="12" TextColor="#666"/>
                            <Label x:Name="TodayOrdersLabel" 
                                   Text="{Binding TodayOrders}" 
                                   FontSize="20" 
                                   FontAttributes="Bold" 
                                   TextColor="#1565C0"/>
                        </VerticalStackLayout>
                    </Frame>
                    
                    <!-- Pending Orders -->
                    <Frame Grid.Column="2" 
                           BackgroundColor="#FFF3E0" 
                           CornerRadius="10" 
                           Padding="12">
                        <VerticalStackLayout>
                            <Label Text="Pendientes" FontSize="12" TextColor="#666"/>
                            <Label x:Name="PendingOrdersLabel" 
                                   Text="{Binding PendingOrders}" 
                                   FontSize="20" 
                                   FontAttributes="Bold" 
                                   TextColor="#EF6C00"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>
                
                <!-- Urgent Orders Alert -->
                <Frame BackgroundColor="#FFEBEE" 
                       CornerRadius="10" 
                       Padding="12"
                       IsVisible="{Binding HasUrgentOrders}">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="âš ï¸" FontSize="20"/>
                        <Label Text="{Binding UrgentOrdersText}" 
                               FontSize="14" 
                               TextColor="#C62828"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Frame>
                
                <!-- Quick Actions -->
                <Label Text="Acciones RÃ¡pidas" FontSize="18" FontAttributes="Bold"/>
                
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="8" ColumnSpacing="8">
                    <Button Grid.Row="0" Grid.Column="0"
                            Text="ðŸ“‹ Ver Pedidos"
                            Clicked="OnViewAllOrdersClicked"
                            BackgroundColor="#FF6B9D"
                            TextColor="White"
                            CornerRadius="8"/>
                    
                    <Button Grid.Row="0" Grid.Column="1"
                            Text="ðŸ“Š AnalÃ­ticas"
                            Clicked="OnViewAnalyticsClicked"
                            BackgroundColor="#6C5CE7"
                            TextColor="White"
                            CornerRadius="8"/>
                    
                    <Button Grid.Row="1" Grid.Column="0"
                            Text="ðŸ“„ Reporte Diario"
                            Clicked="OnExportDailyClicked"
                            BackgroundColor="#00B894"
                            TextColor="White"
                            CornerRadius="8"/>
                    
                    <Button Grid.Row="1" Grid.Column="1"
                            Text="ðŸ“… Reporte Semanal"
                            Clicked="OnExportWeeklyClicked"
                            BackgroundColor="#0984E3"
                            TextColor="White"
                            CornerRadius="8"/>
                </Grid>
                
                <!-- Recent Orders -->
                <Label Text="Pedidos Recientes" FontSize="18" FontAttributes="Bold"/>
                
                <CollectionView ItemsSource="{Binding RecentOrders}"
                                HeightRequest="200">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="0,4" Padding="12" CornerRadius="8">
                                <Grid ColumnDefinitions="*,Auto,Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="{Binding Id, StringFormat='#{0:N}'}" 
                                               FontSize="14" 
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding CreatedAt, StringFormat='{0:dd/MM HH:mm}'}" 
                                               FontSize="12" 
                                               TextColor="#666"/>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Total, StringFormat='S/. {0:F2}'}" 
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="2" 
                                           Text="{Binding Status}" 
                                           FontSize="12"
                                           VerticalOptions="Center"
                                           Margin="8,0,0,0"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- Loading Indicator -->
                <ActivityIndicator IsRunning="{Binding IsBusy}" 
                                   IsVisible="{Binding IsBusy}"
                                   Color="#FF6B9D"/>
                
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>