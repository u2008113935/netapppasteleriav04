<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="apppasteleriav04.Views.Profile.ProfilePage"
             Title="{Binding Title}">

    <ContentPage.Content>
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="12">

                <!-- Avatar -->
                <Frame Padding="8" CornerRadius="80" HeightRequest="160" WidthRequest="160" HorizontalOptions="Center">
                    <Image Aspect="AspectFill" HeightRequest="144" WidthRequest="144">
                        <Image.Source>
                            <Binding Path="UserProfile.AvatarPublicUrl">
                                <Binding.TargetNullValue>
                                    <FileImageSource File="avatar_placeholder.png" />
                                </Binding.TargetNullValue>
                            </Binding>
                        </Image.Source>
                    </Image>
                </Frame>

                <Label Text="Email" FontAttributes="Bold" />
                <Label Text="{Binding Email}" FontSize="14" TextColor="Gray" />

                <Label Text="Avatar (path en storage)" FontAttributes="Bold" />
                <Entry Text="{Binding AvatarUrl}" 
                       Placeholder="avatars/usuario1.jpg" 
                       IsEnabled="{Binding IsEditing}" />

                <Label Text="Nombre completo" FontAttributes="Bold" />
                <Entry Text="{Binding FullName}" 
                       Placeholder="Nombre y apellidos" 
                       IsEnabled="{Binding IsEditing}" />

                <!-- Error message -->
                <Label Text="{Binding ErrorMessage}" 
                       TextColor="Red" 
                       IsVisible="{Binding HasError}"
                       FontSize="12"
                       HorizontalOptions="Center" />

                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Button Text="Editar" 
                            Command="{Binding EditProfileCommand}" 
                            IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}" />
                    <Button Text="Guardar" 
                            Command="{Binding SaveProfileCommand}" 
                            IsVisible="{Binding IsEditing}" />
                    <Button Text="Cancelar" 
                            Command="{Binding CancelEditCommand}" 
                            IsVisible="{Binding IsEditing}" />
                    <Button Text="Cerrar sesiÃ³n" 
                            Command="{Binding LogoutCommand}" 
                            IsVisible="{Binding IsEditing, Converter={StaticResource InvertedBoolConverter}}" />
                </HorizontalStackLayout>

                <ActivityIndicator IsVisible="{Binding IsBusy}" 
                                   IsRunning="{Binding IsBusy}" />
            </VerticalStackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>